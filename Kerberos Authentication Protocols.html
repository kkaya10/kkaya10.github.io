<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308555 (en-US, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="433"/>

<div>
<span><div><div><span style="font-weight: bold;">Kerberos Nedir ?</span></div><div><br/></div><div>MIT tarafından geliştirilmiş bir auethentication protkolüdür.RFC 1510 kodu ile standartlaştırılmıştır.</div><div>Windows 2000'den bu yana Active Directory yapısında bu authentication protokolü kullanılmaktadır.</div><p style="padding: 0px 0px 10px; margin: 0px; outline: 0px; list-style: none; font-size: 13px; border: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; color: rgb(99, 101, 106); font-family: &quot;Open Sans&quot;, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></p><div><img src="Kerberos Authentication Protocols_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" style="padding: 4px; margin: 0px; outline: 0px; list-style: none; text-decoration: none; font-size: 13px; vertical-align: baseline; border: 1px solid rgb(221, 221, 221); background: transparent; max-width: 100%; box-sizing: border-box; display: block; overflow: hidden; border-radius: 3px; height: auto; cursor: pointer;" width="271"/></div><div><br/></div><div>Kerberos yunan mitolojisinde 3 başlı bekçi köpeğinin ismidir.</div><div><br/></div><div>Protokoldede 3 farklı sistem mevcuttur ;</div><div><br/></div><ul><li><div>KDC(Key Distribution Center)</div></li><li><div>Client</div></li><li><div>Server (Talep Edilen servisi sağlayan sunucu)</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;">***Kerberos işlemleri esnasında 3 farklı shared key kullanılır. ( SERVER KEY / CLIENT KEY/ KDC KEY )</div><div style="margin-top: 1em; margin-bottom: 1em;">***Kerberos protokolü İletişim için UDP88 ya da TCP88 kullanır.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">Aşağıdaki Figür'ler üzerinden Kerberos'un Çalışma Yapısı Gösterilecektir ; </div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">Kerberos Authentication işlemlerinde sıralama ;</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">1 -  Client TGT ister</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">2 -  KDC TGT verir</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">3 - Client TGT 'yi kullanarak KDC'den TGS ister</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">4 - KDC TGS verir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">5 - CLIENT TGS'yi kullanarak SERVER'dan hizmet alır.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">TICKET GRANTING TICKET </span></div><div style="margin-top: 1em; margin-bottom: 1em;">Her bir client hizmet almak istediği server'a erişmek için KDC ile iletişime geçip önce TGT'ye sahip olmalıdır. </div><div style="margin-top: 1em; margin-bottom: 1em;">TGT ticket'i 10 saat süreyle valid olarak kalır.Bu süre tamamlanınca yenilenir.Bu süreler 7 günü aştığı anda yeni bir TGT ticket'ı için istekte bulunmak gerekecektir.</div><div style="margin-top: 1em; margin-bottom: 1em;">TGT ticket'ına sahip olmak için öncelikle Client  KDC'ye request mesajı yollar. Bu mesajın ismi <span style="font-weight: bold;">AS_REQ</span> 'dir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image.png" type="image/png" data-filename="Image.png" width="582"/></div><div style="margin-top: 1em; margin-bottom: 1em;">*<span style="font-weight: bold;">ClientKey</span> ; user password kullanılarak üretilen bir değerdir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">AS_REQ Mesajının içeriği ; (TGT kapsamında)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">1 - User Principal Name (UPN) : <span style="font-weight: bold;">&quot;account_name@domain_name&quot;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">2 - Domain Name(Realm) : Domain ismi (Kerberos için active directory domain isimler realm olarak geçer.)</div><div style="margin-top: 1em; margin-bottom: 1em;">3 - Service Principal Name (SPN) : Service ait unique bir identifier kullanılır. <span style="font-weight: bold;">&quot;krbtgt/realm_name&quot;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">4 - Supported Cipher Suites : Client tarafından desteklenen kriptografih encrypt algoritma listesidir.</div><div style="margin-top: 1em; margin-bottom: 1em;">5 - Pre-Authentication Timestamp : 1 ocak 1970 tarihinden beri geçen saniye sayısıdır.(epoch time olarak ta bilinir) <span style="color: rgb(255, 175, 0); font-weight: bold;">(ENCRYPTED with ClientKEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">AS_REQ Mesajını aldıktan sonra KDC üzerinde yapılan işlemler ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">KDC istek yapan kullanıcıyı kendi db'sinde arar.Bulduktan sonra bu kullanıcının ClienKey'ini extract (muhtemelen kendi db'sinden) eder.</div><div style="margin-top: 1em; margin-bottom: 1em;">Bu ClientKey kullanılarak Pre-Authentication Timestamp'i decrypt eder.Bu işlem başarılı olursa yani kendi üzerinde bulunan kullanıcının ClientKey 'i ile</div><div style="margin-top: 1em; margin-bottom: 1em;">Pre-Authentication Timestamp 'i encrypte eden ClientKey aynı ise işlem başarılı demektir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Elde edilen Pre-Authentication Timestamp; format olarak istenen şekilde ise ; ve kendi timestamp'i ile arasında 5dk'dan fazla fark yok ise Validate edilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">İleride yapılabilecek bağlantılarda kullanmak üzere SessionKey üretilir. ve AS_REP mesajı bu bilgileri içererek client'a gönderilir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [1].png" type="image/png" data-filename="Image.png" width="467"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">AS_REP Mesajının içeriği ; (TGT kapsamında)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">1 - UPN  (<span style="font-weight: bold;">UNENCRYPTED</span>)</div><div style="margin-top: 1em; margin-bottom: 1em;">2 - Domain Name (<span style="font-weight: bold;">UNENCRYPTED</span>)</div><div style="margin-top: 1em; margin-bottom: 1em;">3 - UPN <span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">4 - Domain Name<span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">5 - SPN<span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">6 - Copy of the Session Key<span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">7 - PAC<span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">8 - TimeToLive<span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">9 - TimeToLive <span style="color: rgb(255, 175, 0); font-weight: bold;">(ENCRYPTED with ClientKEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">10 - Copy of the Session Key <span style="color: rgb(255, 175, 0); font-weight: bold;">(ENCRYPTED with ClientKEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">11 - Pre-Authentication TimeStamp <span style="color: rgb(255, 175, 0); font-weight: bold;">(ENCRYPTED with ClientKEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">AS_REP Mesajını aldıktan sonra client üzerinde yapılan işlemler ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">Pre-Authentication Timestamp değeri ClientKey ile decrypt edilir ve validate edilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Session Key extract edilir.(TGS_REQ mesajında kullanmak üzere)</div><div style="margin-top: 1em; margin-bottom: 1em;">TGT 'yi memor üzerinde SSP/AP'ye kaydeder.(ihtiyaç duyulduğunda kullanılacaktır.)</div><div style="margin-top: 1em; margin-bottom: 1em;">***SessionKey ile KDC key aynı şey değildir.***</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [2].png" type="image/png" data-filename="Image.png" width="596"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(255, 0, 0); font-weight: bold;">**Client TGT 'yi aldıktan sonra TGS Ticket için istek yapmaya hazır hale gelir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">TICKET GRANTING SERVICE (TGS) TICKET </span></div><div style="margin-top: 1em; margin-bottom: 1em;">TGS yani Ticket Granting Service bileti ; spesifik bir service üzerinde hizmet almak amaçlı kullanılır.TGT kullanılarak KDC 'den TGS bileti için istek yapılır. (Service Ticket ismi ilede bilinir.)</div><div style="margin-top: 1em; margin-bottom: 1em;">TGS Service Ticket'ı default'da 10 saat valid durumdadır.Sonrasında yenilenmesi gerekir.</div><div style="margin-top: 1em; margin-bottom: 1em;">***Active Directory'de TGS ticket'lar yenilenmez.***</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">Client TGS_REQ mesajını KDC'ye göndererek TGS Service Ticket için istekte bulunur.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [3].png" type="image/png" data-filename="Image.png" width="511"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">TGS_REQ Mesajının içeriği ; (TGS kapsamında)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">1 - UPN</div><div style="margin-top: 1em; margin-bottom: 1em;">2 - Domain Name</div><div style="margin-top: 1em; margin-bottom: 1em;">3 - SPN (Service Principal Name)</div><div style="margin-top: 1em; margin-bottom: 1em;">4 - TGT (Ticket Granting Ticket)  <span style="color: rgb(45, 79, 201); font-weight: bold;">(ENCRYPTED with KDC_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">5 - Pre-Authentication Timestamp <span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">TGS_REQ Mesajını aldıktan sonra KDC üzerinde yapılan işlemler ;</span></div><ul><li><div style="margin-top: 1em; margin-bottom: 1em;">TGT 'yi <span style="color: rgb(45, 79, 201); font-weight: bold;">KDC_KEY</span> kullanarak decrypt eder.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">TGT içerisinden SESSION_KEY 'i extract eder.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">Extract ettiği SESSION_KEY ile Pre-Authentication Timestamp'i validate eder.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">TGS SESSION_KEY üretir.</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;">**TGT içerisinden gelip kaydedilen SESSION_KEY ile Pre-Authentication Timestamp'i encrypte ederken kullanılan SESSION_KEY aynı olmalıdır.(doğal olarak)</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(255, 0, 0); font-weight: bold;">***Timestamp Validation işlemi başarıyla sonuçlanırsa KDC bu sefer TGS_REP mesajını oluşturmak için hazırlıklara başlar ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 16pt; font-weight: bold;">TGS_REP Mesajının hazırlanması ve İçeriği ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">Servers TGS Data denilen section hazırlanır.(Sanırım hizmet alınmak istenen server'a yollancak ticket'dan bahsediliyor.)</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 14pt; font-weight: bold;">SERVER's TGS DATA içeriği;  ( 1-7 arası Server'S TGS Data Field olarak adlandırılıyor.)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(65, 173, 28); font-weight: bold;">*SERVER_KEY'i sadece KDC ve SERVER biliyor.</span></div><div style="margin-top: 1em; margin-bottom: 1em;">1 - UPN <span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">2 - SPN <span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">3 - TimeToLive<span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">4 - Copy of <span style="font-weight: bold;">TGS_SESSION_KEY (</span> Hizmet alınmak istenen server tarafından gelecekteki bağlantılarda kullanılmak üzere)<span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">5 - Privilege Attribute Certificate (PAC) :  ek bilgi içeren Microsoft Extension'udur.<span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">6 - PAC Server Signature : keyed/salted signature of the PAC field olarak tanımlaması yapılmış.Bu alanın keylenmesinde SERVER_KEY kullanılmış yani sadece KDC ve Server tarafından bilinen bir key. <span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">    SERVER_KEY : Server'ın account password hash'i temel alınarak oluşturulmuştur.  Bu signature PAC alanlarının bütünlüğünü kontrol amaçlı kullanılır.<span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">7 - PAC KDC Signature : PAC Server Signature tarafından keyed/salted edilmiş hash değeri.<span style="color: rgb(65, 173, 28); font-weight: bold;">(ENCRYPTED with SERVER_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(255, 0, 0); font-weight: bold;">*SESSION_KEY'i sadece Client ve KDC biliyor.</span></div><div style="margin-top: 1em; margin-bottom: 1em;">8 - UPN <span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">9 - SPN <span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">10 - TimeToLive <span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;">11 - Copy Of the TGS _SESSION_KEY <span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">*** Pre-Authentication Timestamp  </span><span style="color: rgb(255, 0, 0); font-weight: bold;">(ENCRYPTED with SESSION_KEY)</span> <span style="font-weight: bold;">TGS_REP' içerisine KDC tarafından eklenir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">Bu içerik bilgisi ile birlikte TGS_REP client'a gönderilir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;"><img src="Kerberos Authentication Protocols_files/Image [4].png" type="image/png" data-filename="Image.png" width="526"/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">TGS_REP Mesajını aldıktan sonra Client üzerinde yapılan işlemler ;</span></div><ul><li><div style="margin-top: 1em; margin-bottom: 1em;">TGS_REP içerisinde ki Pre-Authentication Timestamp'i SESSION_KEY ile validate eder.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">TGS_SESSION_KEY'i extract eder.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">Bu aşamada Client'a gönderilen SERVER_KEY ile encrypte edilmiş dosyalar Client tarafından açılamaz durumdadır. (SERVER_KEY client tarafından bilinmemektedir.)</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">Hizmet alınacak SERVER'a <span style="font-weight: bold;">AP_REQ</span> mesajı gönderilir.</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [5].png" type="image/png" data-filename="Image.png" width="558"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 14pt; font-weight: bold;">AP_REQ Mesajı içeriği; </span></div><div style="margin-top: 1em; margin-bottom: 1em;">1 - Tüm standart alanlar (UPN,SPN,Domain Name)</div><div style="margin-top: 1em; margin-bottom: 1em;">2 -  TGS_REP mesajı içerisinden Server's TGS Data Field (1-7 maddeleri)</div><div style="margin-top: 1em; margin-bottom: 1em;">3 - KDC tarafından gönderilen TGS_REP mesajı içerisinden alınan Pre-Authentication Timestamp<span style="color: rgb(158, 0, 243);"> </span><span style="color: rgb(158, 0, 243); font-weight: bold;">(ENCRYPTED with TGS_SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;">AP_REQ Mesajını aldıktan sonra SERVER üzerinde yapılan işlemler ;</span></div><ul><li><div style="margin-top: 1em; margin-bottom: 1em;">SERVER_KEY kullanarak Server's TGS Data alanı decrypt edilir.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">Copy of TGS_SESSION_KEY extract edilir.</div></li><li><div style="margin-top: 1em; margin-bottom: 1em;">TGS_SESSION_KEY kullanılarak AP_REQ içerisinden gelen Pre-Authentication Timestamp validate edilir.</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;">***EĞER Timestamp validate edilirse; Server ilgili client'ı authenticate eder.Bunun sebebi Server's TGS Data alanını sadece KDC 'nin encrypte edebileceğini; SERVER 'da bildiği için. SERVER bu datayı decrypte edebilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">***Client 'da TGS_SESSION_KEY'i  extract edebilir(bunun anlamı KDC tarafından authenticate olmuştur.)</div><ul><li><div style="margin-top: 1em; margin-bottom: 1em;">AP_REP mesajı Client'a gönderilir.</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [6].png" type="image/png" data-filename="Image.png" width="552"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 14pt; font-weight: bold;">AP_REP Mesajı içeriği; </span></div><div style="margin-top: 1em; margin-bottom: 1em;">diğer alanlara ek olarak ;</div><div style="margin-top: 1em; margin-bottom: 1em;">1 - Pre-Authentication Timestamp <span style="color: rgb(158, 0, 243); font-weight: bold;">(ENCRYPTED with TGS_SESSION_KEY)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-size: 16pt;">BU ŞEKİLDE AUTHENTICATION İŞLEMİ GERÇEKLEŞİR.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-size: 12pt;">EK DURUMLAR  VE BİLGİLER ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-size: 12pt;">*Successful AS_REQ Message ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Authentication işlemi başarılı sonuçlandı ise ve TGT başarıyla client'a verildi ise ; DomainController üzerinde &quot;4768&quot; A Kerberos authentication ticket(TGT) was requested.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">event'ı oluşur.Yani Client tarafından gönderilen bir TGT isteği DC'de bu şekilde belirir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Örnek Event ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Account Name : İsteği yapan kullanıcı :</span> <span style="font-size: 10pt; font-weight: bold;">kk</span></div><div style="margin-top: 1em; margin-bottom: 1em;">Supplied Realm Name :<span style="font-weight: bold;">BANKA</span> domaini üzerinde authenticate olmak istiyor. Burada ek bir bilgi mevcut ; interactive authentication esnasında burada full domain name yazar ; diğer logon tiplerinde NETBIOS name.</div><div style="margin-top: 1em; margin-bottom: 1em;">(NETBIOS name : BANKA)(Domain name: BANKA.LOCAL)</div><div style="margin-top: 1em; margin-bottom: 1em;">Service Name : Hizmet almak istenilen servis ismidir.TGT Request'i olduğu için her zaman krbtgt'dir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Service ID : krbtgt'nin domain üzerindeki sid numarasıdır. (bu örnekte verilmemiş)</div><div style="margin-top: 1em; margin-bottom: 1em;">Client Address : Client IP adresi</div><div style="margin-top: 1em; margin-bottom: 1em;">Client Port: Malum bilgi.</div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [7].png" type="image/png" data-filename="Image.png" width="590"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Ticket Options : Client tarafından talep edilen options bilgisidir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Result Code : DC'de ki validation işlemi ile ilgili sonuc code'u içerir.(TGT verilince 0x0 olarak değer set edilir.)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Ticket Encryption : Encryption type'ları belirtir.(tablosu var)</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Pre-Authentication Type : DC tarafından AS_REQ 'mesajı esnasında alınmış olan Code'dur.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">Certificate alanları ; ilgili bilgiyi içerir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;"><img src="Kerberos Authentication Protocols_files/Image [8].png" type="image/png" data-filename="Image.png"/></span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-size: 12pt;">KERBEROS TGT and TGS Tickets Enryption Types Table : </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">KERBEROS TGT Tickets Pre-Authentication Types Table : </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">#&quot;klist tgt&quot; komutu ile tgt görüntülenebilir.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;"><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-size: 12pt;">Unsuccessfull AS_REQ Mesajı ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">4771 Event ID'ye sahip event bu durumu belirtir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Sebepler ;</div><div style="margin-top: 1em; margin-bottom: 1em;">password yanlıslığı , password expires durumu , smart-card authentication ile ilgili problemler olabilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Tüm bu durumlar Pre-Aut Timestamp ile ilgilidir.</div><div style="margin-top: 1em; margin-bottom: 1em;">4771 Event'i generate ediliyorsa 4768 Audit Failure event'ı generate edilmez.</div><div style="margin-top: 1em; margin-bottom: 1em;">Bu event'da bulunan alanlar 4768 event'ındakilerle aynı anlama sahiptir. Extradan sadece failure code içerebilir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">0x10 =&gt; Sertifika problemler</div><div style="margin-top: 1em; margin-bottom: 1em;">0x17 =&gt; password expired</div><div style="margin-top: 1em; margin-bottom: 1em;">0x18 =&gt; password wrong</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">*Disable durumda olan bir kullanıcı için Kerberos Authentication denenirse &quot;4768 Audit Failure&quot; oluşur.</div><div style="margin-top: 1em; margin-bottom: 1em;">Alan açıklamalar 4768 Audit Success ile aynı olmaklar beraber bazı farklılıklar mevcuttur.</div><div style="margin-top: 1em; margin-bottom: 1em;">User ID : S-1-0-0'dır daima</div><div style="margin-top: 1em; margin-bottom: 1em;">Service ID : S-1-0-0 'dır daima</div><div style="margin-top: 1em; margin-bottom: 1em;">Ticket Encrtyption : 0xfffff'dir.</div><div style="margin-top: 1em; margin-bottom: 1em;">Result Code :0x12'dir  =&gt; disabled account  kullanıldığını belirtir.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;"> </span><span style="font-size: 12pt; font-weight: bold;">*TGT Renewal Message ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">4770 ID'li  Event  ;  10 saat'de bir yenilenen bu ticket için DC'de event viewer'a düşer.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;">4770 A Kerberos service ticket was renewed.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">*Successful TGS_REQ Message ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">TGS_REQ request'i her zaman önce DC'ye düşer.</div><div style="margin-top: 1em; margin-bottom: 1em;">4769 DC tarafından üretilen event'dır ve TGS isteği olduğunda düşer.</div><div style="margin-top: 1em; margin-bottom: 1em;">4769 A Kerberos ticket service was requested.</div><div style="margin-top: 1em; margin-bottom: 1em;">Bu mesaj TGS_REQ ile alakalıdır. TGS Ticket ile değil.</div><div style="margin-top: 1em; margin-bottom: 1em;">Örnek 4769 Event'ı ;</div><div style="margin-top: 1em; margin-bottom: 1em;">Logon GUID verisi ; 4624,4648,4664 ile korole edilebilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">4769 tam olarak hangi servis için hizmet istendiğini söylemez.</div><div style="margin-top: 1em; margin-bottom: 1em;">Service ID : Hizmet istenen servis için SID içerir denmiş ancak bizde o şekilde değil (forwareded tgt olarak geçiyor bu durum)</div><div style="margin-top: 1em; margin-bottom: 1em;">Audit Success mesajı için failure code her zaman 0x0 'dır.</div><div style="margin-top: 1em; margin-bottom: 1em;">Transited Service  : Client tarafından request edilen SPN listesi </div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="Kerberos Authentication Protocols_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-weight: bold;">*Unsuccessful TGS_REQ ve AP_REQ Message ;</span></div><div style="margin-top: 1em; margin-bottom: 1em;">Bu iki mesaj DC tarafından farklı hatalardan kaynaklı olarak alınır.</div><div style="margin-top: 1em; margin-bottom: 1em;">En çok karşılaşılan hata ise ; Expired TGS ile yapılan AP_REQ istediğidir.</div><div style="margin-top: 1em; margin-bottom: 1em;">4769 ID'si ile Expired TGS ile yapılan bir AP_REQ mesajı ve isteği'nde ;</div><div style="margin-top: 1em; margin-bottom: 1em;">    Audit Failure olarak belirtilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">    Logon-UID bölümü sadece 0'lardan oluşur.</div><div style="margin-top: 1em; margin-bottom: 1em;">    encryption type : ff'olarak verilir.</div><div style="margin-top: 1em; margin-bottom: 1em;">    Failure code  : 0x20 'dir.</div><div style="margin-top: 1em; margin-bottom: 1em;"></div><div style="margin-top: 1em; margin-bottom: 1em;">Bu hata event'ı tgs ticket ile ilgili değil DC'ye gönderilen TGS_REQ yad AP_REQ mesajları ile alakalıdır.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;">*AP_REQ mesajı için oluşan bir failure event'ında ;  Account Information ve Service Information bölümlerinde detay bulunmaz.Ticket encryption type : 0xfffff olarak geçer.</div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><br/></font></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div><div style="margin-top: 1em; margin-bottom: 1em;"><br/></div></div><div><br/></div></span>
</div></body></html> 